<script>
  function setCommonEvent() {
    const form = document.getElementById("form");
    form.addEventListener("submit", onSubmit);
    window.addEventListener("resize", resizeBody);
    resizeBody();
  }

  function serializeFormToJson(form) {
    const formData = new FormData(form);
    const jsonData = {};

    formData.forEach((value, key) => {
      jsonData[key] = value.toString();
    });
    return jsonData;
  }

  function resizeBody() {
    var scale = window.innerWidth / window.screen.width;
    document.body.style.width = 100 / scale + "%";
    document.body.style.height = 100 / scale + "%";
    document.body.style.transform = "scale(" + scale + ")";
  };

  function onSubmit(e) {
    e.preventDefault(); //デフォルトの動作をキャンセル

    const form = document.getElementById("form");
    const resultDiv = document.getElementById("result");
    const loadingSpinner = document.getElementById("loadingSpinner");
    loadingSpinner.style.display = "block";

    const postString = JSON.stringify(serializeFormToJson(form));
    // console.log(postString);

    google.script.run
      .withSuccessHandler(onSuccess)
      .withFailureHandler(onFailure)
      .postToServer(postString);
    function onSuccess(data) {
      // console.log("onSuccess");
      // console.log(data);
      form.style.display = "none";
      resultDiv.innerHTML = data;
      loadingSpinner.style.display = "none";
    }
    function onFailure(error) {
      // console.log("onFailure");
      // console.log(error);
      form.style.display = "none";
      resultDiv.innerHTML = "エラーが発生しました: " + error;
      loadingSpinner.style.display = "none";
    }
  }
</script>